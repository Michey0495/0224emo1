# emo1 - ブラウザ用AIチャットアプリ

静岡セミナー完成版デモ | 2026年2月24日
Author: Givery EZOAI 安田光喜

---

## 概要

emo1 は、本日のセミナーで作成したブラウザ用AIチャットアプリケーションです。
OpenAI API と接続し、入力したテキストに対してリアルタイムにAIが応答を返します。応答はストリーミング形式で1文字ずつ画面に表示されるため、長い回答でも待ち時間をほとんど感じません。

スマートフォン、タブレット、PCのいずれからでもアクセスできます。React や Vue といったフロントエンドフレームワークは使わず、Vanilla HTML/CSS/JS だけで構成しました。コードの流れを追いやすくするための判断です。

## セミナーで体験したこと

デモでご覧いただいた内容を振り返ります。

- テキストを入力すると、AIが1文字ずつストリーミングで回答を返す様子
- システムプロンプトを変更すると、AIの応答トーンや専門性が変わること
- GPT-4o-mini / GPT-4o / GPT-4.1-mini / GPT-4.1 のモデル切り替えによる回答品質の違い
- マークダウン形式の回答がリッチに表示される仕組み（コードブロック、リスト、テーブル）
- APIキーがブラウザ側に露出しない構造

これらの機能がどのように実装されているか、ぜひご自身の環境で動かしながら確認してみてください。

## 自分で動かす手順

### 前提条件

Node.js v18 以上がインストールされている必要があります。
バージョンの確認はターミナルで以下のコマンドを実行してください。

```bash
node -v
```

v18.x.x 以上の数値が表示されれば問題ありません。
Node.js が未インストールの場合は、公式サイト https://nodejs.org からダウンロードしてください。

### OpenAI APIキーの取得

1. https://platform.openai.com にアクセスします
2. お持ちのアカウントでログインします（アカウントがない場合は新規作成してください）
3. 画面左メニューから「API Keys」を選択します
4. 「Create new secret key」ボタンをクリックします
5. 表示されたキー（`sk-` で始まる文字列）をコピーして控えておきます

このキーは一度しか表示されません。紛失した場合は再発行が必要になります。

### インストールと起動

```bash
# 1. 依存パッケージをインストールします
npm install

# 2. 環境変数ファイルをコピーします
cp .env.example .env

# 3. .env ファイルを開き、取得したAPIキーを設定します
#    OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxx

# 4. サーバーを起動します
npm start

# 5. ブラウザで以下のURLにアクセスします
#    http://localhost:3000
```

開発中にファイル変更を自動検知して再起動したい場合は `npm run dev` を使います。Node.js の `--watch` フラグを利用した仕組みです。

## 技術スタック

| カテゴリ | 技術 | 役割 |
|---|---|---|
| バックエンド | Node.js + Express | APIプロキシ、静的ファイル配信 |
| AI API | OpenAI GPT-4o-mini | チャット応答の生成 |
| フロントエンド | Vanilla HTML/CSS/JS | UI全般（フレームワーク不使用） |
| セキュリティ | Helmet, express-rate-limit, sanitize-html | ヘッダー保護、流量制限、入力サニタイズ |
| 環境管理 | dotenv | APIキーなど秘匿情報の管理 |
| CORS | cors | クロスオリジン制御 |

## アーキテクチャ

```
[ブラウザ]  ←→  [Express Server]  ←→  [OpenAI API]
    ↑                  ↑
    HTML/CSS/JS        Rate Limit
    Markdown           Sanitize
    SSE Stream         Helmet
```

ブラウザからExpressサーバーへPOSTリクエストを送り、サーバーがOpenAI APIを呼び出します。レスポンスはSSE（Server-Sent Events）形式でブラウザへ逐次返却されます。APIキーはサーバー側にのみ存在するため、ブラウザからは一切見えない設計です。

## ディレクトリ構成

```
0224emo1/
├── server.js          # Expressサーバー（APIプロキシ）
├── package.json       # 依存パッケージ定義
├── .env.example       # 環境変数テンプレート
├── .gitignore
├── README.md          # このファイル
├── CODE_GUIDE.md      # コード解説ガイド
├── RISK_GUIDE.md      # AI生成コードのリスクガイド
└── public/
    ├── index.html     # メインページ
    ├── css/
    │   └── style.css  # スタイルシート
    ├── js/
    │   └── app.js     # クライアントロジック
    └── assets/
        └── logo.svg   # アプリロゴ
```

## 主要機能一覧

- リアルタイムストリーミング応答（SSE）
- マークダウンレンダリング（コードブロック、リスト、テーブル等）
- コードブロックのコピー機能
- システムプロンプトのカスタマイズ
- モデル選択（gpt-4o-mini / gpt-4o / gpt-4.1-mini / gpt-4.1）
- レスポンシブデザイン（モバイル対応）
- セキュリティ対策（入力サニタイズ、レート制限、セキュリティヘッダー）
- ヘルスチェックエンドポイント（`/api/health`）

## コードを読むためのガイド

各ファイルの役割やコードの流れを詳しく知りたい方は、CODE_GUIDE.md を参照してください。
サーバー側の処理からフロントエンドの描画ロジックまで、セミナーで解説した内容を文書としてまとめています。セミナー後の復習にお使いいただけます。

## AI生成コードのリスクについて

AIにコードを書かせると生産性は飛躍的に向上しますが、生成されたコードをそのまま使うことにはリスクが伴います。
RISK_GUIDE.md では、AI生成コードに潜む問題を5つのカテゴリに分けて整理し、emo1 アプリで実際にどう対策しているかを示しています。AI活用を進めるうえで、ぜひ一読ください。

## セキュリティに関する注意

APIキーは `.env` ファイルで管理し、Gitにはコミットしないでください。このプロジェクトでは `.gitignore` で `.env` を除外済みです。

取り扱いで守っていただきたい点は以下のとおりです。

- APIキーを他人と共有しない
- APIキーをソースコードに直接書き込まない
- 不要になったキーは OpenAI のダッシュボードから無効化する
- `.env` ファイルをメールやチャットで送信しない

本アプリはセミナーのデモ環境向けに作られたものです。本番運用する場合は、CORSの許可オリジン明示指定、レート制限値の厳格化、HTTPSの必須化、ログ収集と異常検知の仕組みの追加を検討してください。

## トラブルシューティング

### npm install が失敗する

Node.js のバージョンが古い可能性があります。`node -v` で v18 以上であることを確認してください。
v18 未満の場合は、Node.js 公式サイトから最新のLTS版をインストールし直す必要があります。

### サーバーは起動するがAIが応答しない

APIキーの設定を確認してください。`.env` ファイルが存在するか、`OPENAI_API_KEY` の値が正しく入っているかをチェックします。
キーの先頭が `sk-` で始まっていること、前後に余分なスペースや改行が入っていないことも確認対象です。

### レート制限に引っかかる

短時間に多くのリクエストを送ると、サーバー側のレート制限またはOpenAI API側の制限に該当する場合があります。
1分ほど待ってから再度試してください。それでも解消しない場合は、OpenAIダッシュボードでAPI利用状況を確認してみてください。

## ライセンス

MIT License

## クレジット

- Author: Givery EZOAI 安田光喜
- Date: 2026-02-24
- Powered by OpenAI API
